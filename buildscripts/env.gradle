static def readEnv(String key) {
    def value = (System.getenv(key) ?: "").trim()
    println("DEBUG: $key = $value")
    return value
}

static def isCI() {
    readEnv("CI").toBoolean()
}

static def keystorePath() {
    readEnv("BITRISEIO_ANDROID_KEYSTORE_PATH")
}

static def gitDescribe() {
    "git describe --tags --abbrev=0".execute().text.trim()
}

static def revisions() {
    "git rev-list ${gitDescribe()}..HEAD --count".execute().text.trim()
}

static def commitSHA() {
    "git rev-parse HEAD".execute().text.substring(0, 7).trim()
}

static def inferVersionName() {
    def bitriseTag = readEnv("BITRISE_GIT_TAG")
    def semVer = "${gitDescribe()}+${revisions()}.${commitSHA()}"
    def verName = !bitriseTag.isEmpty() ? bitriseTag : (!semVer.isEmpty() ? semVer : null)
    if (verName != null) println ("DashKotlin v$verName")
    return verName
}

static def specialSigningRequired() {
    return isCI() && !keystorePath().isEmpty()
}

ext.readEnv = this.&readEnv
ext.inferVersionName = this.&inferVersionName
ext.isCI = this.&isCI
ext.specialSigningRequired = this.&specialSigningRequired
ext.keystorePath = this.&keystorePath